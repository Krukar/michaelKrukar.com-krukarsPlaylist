var tag=document.createElement("script");tag.src="http://www.youtube.com/iframe_api";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);var customPlaylists=["krukar","live laugh love"];var quickSearchTimer;var youTubeState=0;var KPApp=angular.module("krukarsPlaylist",["ui.sortable"]);KPApp.controller("mainController",["$rootScope","$scope","$window","ajaxCalls",function(e,t,n,r){t.results=[];t.playlist=localStorage.playlist===undefined?[]:angular.fromJson(localStorage.playlist);t.popUpMessage="";t.showPopUp=false;t.pause=false;t.mute=false;t.currentSong=localStorage.currentSong===undefined?0:localStorage.currentSong;t.shuffle=localStorage.shuffle===undefined?false:angular.fromJson(localStorage.shuffle);t.showVideo=localStorage.showVideo===undefined?true:angular.fromJson(localStorage.showVideo);e.header="Krukar's Playlist";t.quickSearch=function(){t.results=[];clearTimeout(quickSearchTimer);if(t.newSearch){quickSearchTimer=setTimeout(t.lastFMSearchResults,500,t.newSearch)}};t.lastFMSearchResults=function(e){r.getLastFM(e).then(function(e){if(e.length!=3){angular.forEach(e.results.trackmatches.track,function(n,r){if(e.results.trackmatches.track[r].artist){var i={artist:e.results.trackmatches.track[r].artist,title:e.results.trackmatches.track[r].name};t.results.push(i)}})}})};t.clickResult=function(){var e=t.results[this.$index].artist;var n=t.results[this.$index].title;var i=this.$index;var s=e+" - "+n;r.getYouTube(s).then(function(r){var s={artist:e,title:n,id:r.feed.entry[0].media$group.yt$videoid.$t};t.results.splice(i,1);t.addToPlaylist(s)})};t.submitSearch=function(){var e=t.newSearch;t.resetForm();if(customPlaylists.indexOf(e)>-1){t.customSubmit(e)}else if(e.substring(0,3)=="KP0"){t.mysqlGet(e)}else{r.getLastFM(e).then(function(n){var i=n.length==3?true:false;var s=i?e:angular.isArray(n.results.trackmatches.track)?n.results.trackmatches.track[0].artist+" - "+n.results.trackmatches.track[0].name:e;r.getYouTube(s).then(function(e){if(e.feed.openSearch$totalResults.$t>0){var r=i?"":angular.isArray(n.results.trackmatches.track)?n.results.trackmatches.track[0].artist:"";var s=i?e.feed.entry[0].title.$t:angular.isArray(n.results.trackmatches.track)?n.results.trackmatches.track[0].name:e.feed.entry[0].title.$t;var o=e.feed.entry[0].media$group.yt$videoid.$t;var u={artist:r,title:s,id:o};t.addToPlaylist(u)}else{t.popUp("Sorry, we could not find what you were looking for.")}})})}};t.addToPlaylist=function(e){t.playlist.push(e);if(t.playlist.length==1){t.playVideo()}t.storeLocally()};t.mysqlSave=function(){if(t.playlist.length>=1){r.setMYSQL(t.playlist).then(function(e){localStorage.setItem("kpid",e);t.popUp("Your playlist has been saved. Paste "+e+" to retrieve it.");t.$apply()})}else{t.popUp("Sorry, you need at least 1 song in your playlist to save.")}};t.mysqlGet=function(e){r.getMYSQL(e).then(function(n){if(n.length>=1){t.playlist=angular.fromJson(n);t.popUp("Loaded playlist "+e);t.currentSong=0;t.playVideo();t.$apply()}else{t.popUp("Sorry, could not load that playlist.")}})};t.resetForm=function(){t.newSearch="";t.results=[]};t.storeLocally=function(){localStorage.setItem("playlist",angular.toJson(t.playlist));localStorage.setItem("currentSong",t.currentSong);localStorage.setItem("showVideo",angular.toJson(t.showVideo));localStorage.setItem("shuffle",angular.toJson(t.shuffle))};t.goToSong=function(){t.currentSong=this.$index;t.playVideo();t.showMenu=!t.showMenu;t.storeLocally()};t.removeSong=function(){t.playlist.splice(this.$index,1);if(t.currentSong==this.$index){t.nextSong()}else{t.currentSong=t.currentSong<this.$index?t.currentSong:t.currentSong<=0?0:t.currentSong-1}t.storeLocally()};t.clearPlaylist=function(){t.showMenu=!t.showMenu;t.playlist=[];t.currentSong=0;player.stopVideo();e.header="Krukar's Playlist";t.storeLocally()};t.pauseVideo=function(){if(youTubeState==1){t.pause=true;player.pauseVideo()}else if(youTubeState==2){t.pause=false;player.playVideo()}else{t.playVideo()}};t.previousSong=function(){if(t.playlist.length>=1){t.currentSong=t.currentSong<=0?t.playlist.length-1:t.currentSong-1;t.playVideo();t.storeLocally()}};t.nextSong=function(){if(t.playlist.length>=1){t.currentSong=t.shuffle?Math.floor(Math.random()*(t.playlist.length-1-0+1))+0:t.currentSong>=t.playlist.length-1?0:t.currentSong+1;t.playVideo();t.storeLocally()}};t.toggleMute=function(){t.mute=!t.mute;if(t.mute){player.mute()}else{player.unMute()}};t.toggleShuffle=function(){t.shuffle=!t.shuffle;t.storeLocally()};t.toggleVideo=function(){t.showVideo=!t.showVideo;t.storeLocally()};t.customSubmit=function(e){r.getCustomPlaylist().then(function(n){t.playlist=t.playlist.concat(n.data[e]);t.shuffle=false;t.currentSong=0;t.playVideo();t.popUp("Enjoy "+e+"'s playlist.",3e3);t.storeLocally()})};t.popUp=function(e,n){t.showPopUp=true;t.popUpMessage=e};n.onYouTubeIframeAPIReady=function(){player=new YT.Player("video",{height:"100%",width:"100%",playerVars:{hd:1,rel:0,showinfo:0,iv_load_policy:3,controls:0},events:{onStateChange:t.onPlayerStateChange}})};t.onPlayerStateChange=function(e){youTubeState=e.data;if(e.data==0){t.nextSong();t.$apply()}};t.playVideo=function(){player.loadVideoById(t.playlist[t.currentSong].id);e.header=t.playlist[t.currentSong].title+" - "+t.playlist[t.currentSong].artist}}]);KPApp.factory("ajaxCalls",["$http",function(e){return{getLastFM:function(t){var n=e.get("http://ws.audioscrobbler.com/2.0/?method=track.search&track="+t+"&api_key=b5ac351ccf761532804efb7262b8c320&format=json&limit=10").then(function(e){return e.data});return n},getYouTube:function(t){var n=e.get("https://gdata.youtube.com/feeds/api/videos?q="+t+"&max-results=1&alt=json&v=2").then(function(e){return e.data});return n},getCustomPlaylist:function(){var t=e.get("custom.json").then(function(e){return e});return t},setMYSQL:function(e){var t=localStorage.kpid===undefined?undefined:localStorage.kpid;var n=$.post("php/setMYSQL.php",{phpKpid:t,phpPlaylist:angular.toJson(e)}).then(function(e){console.log(e);return e});return n},getMYSQL:function(e){var t=$.post("php/getMYSQL.php",{phpKpid:e}).then(function(e){return e});return t}}}]);(function(e,t,n,r,i,s,o){e["GoogleAnalyticsObject"]=i;e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date;s=t.createElement(n),o=t.getElementsByTagName(n)[0];s.async=1;s.src=r;o.parentNode.insertBefore(s,o)})(window,document,"script","//www.google-analytics.com/analytics.js","ga");ga("create","UA-12435905-12","auto");ga("send","pageview")